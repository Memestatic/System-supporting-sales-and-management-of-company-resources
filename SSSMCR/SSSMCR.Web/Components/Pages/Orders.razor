@page "/orders"
@using SSSMCR.Web.Services
@using SSSMCR.Web.Components.Components.Tables
@rendermode InteractiveServer
@inject NavigationManager Nav
@inject IAuthService AuthService

<PageTitle>Orders</PageTitle>

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h5" Class="mb-4">Orders</MudText>

    <OrdersTable />
</MudPaper>

@code{
    [Inject] Blazored.LocalStorage.ILocalStorageService LocalStorage { get; set; } = default!;
    private string? user_role;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;
        
        
        try
        {
            user_role = await LocalStorage.GetItemAsync<string>("user_role");
            if (!AuthService.PermittedForOrders(user_role))
            {
                Nav.NavigateTo("/");
            }
        }
        catch (InvalidOperationException)
        {
            
        }
        
        StateHasChanged();
    }

}