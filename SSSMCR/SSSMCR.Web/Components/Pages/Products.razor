@page "/products"
@using SSSMCR.Web.Components.Components.Tables
@using SSSMCR.Web.Services
@inherits LayoutComponentBase
@inject NavigationManager Nav
@inject IAuthService AuthService

<PageTitle>Products</PageTitle>

<MudContainer MaxWidth="MaxWidth.False" Class="pa-4">
    <MudText Typo="Typo.h4" Class="mb-4">Product Management</MudText>

    <ProductsTable />
</MudContainer>

@code{
    [Inject] Blazored.LocalStorage.ILocalStorageService LocalStorage { get; set; } = default!;
    private string? user_role;
    
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;
        
        
        try
        {
            user_role = await LocalStorage.GetItemAsync<string>("user_role");
            if (!AuthService.PermittedForManagement(user_role))
            {
                Nav.NavigateTo("/");
            }
        }
        catch (InvalidOperationException)
        {
            
        }
        
        StateHasChanged();
    }

}